name: nightly-build

on:
  schedule:
    - cron: '0 0 * * *'
  push:
    branches:
      - develop

jobs:
  nightly-build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Configure Docker
        uses: docker/login-action@v1
        with:
          registry: docker.io
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Build Docker image
        run: docker build -t myapp:dev-$(date +"%Y-%m-%d") .

      - name: Ejecutar todos los test del paquete es.codeurjc.ais
        run: mvn -B '-Dtest=es.codeurjc.ais.*Test' test

      - name: subir la imagen docker a DockerHub
        run: docker push myapp:dev-$(date +"%Y-%m-%d")